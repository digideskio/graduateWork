
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title></title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="hljs/styles/ir_black.css">
    <script type="text/javascript" src="slideshow.js"></script>
    <script src="hljs/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div class="progress">
      <div class="progress-bar"></div>
    </div>

    <div class="slide" id="slide-1">
      <section class="slide-content">
        <h1 id="role-of-cellular-proteins">Mapping the Unmapped Human Genome</h1>
        <h2 id="-nbsp-">&nbsp;</h2>
        <h2 id="christopher-wetherill">Christopher Wetherill</h2>
        <h2 id="mcdonald-lab">Garner Lab</h2>
      </section>
    </div>

    <div class="slide hidden" id="slide-2">
      <section class="slide-content">
        <h3>Our Data</h3>
        <ul>
          <li>150 genomes</li>
          <li>13 ethnic populations</li>
          <li>~750,000,000 unmapped reads</li>
          <li>~4.5MM unmapped reads per individual</li>
        </ul>
      </section>
    </div>

    <div class="slide hidden" id="slide-3">
      <section class="slide-content">
        <h3>Getting Started with Shadowfax</h3>
        <ul>
          <li>All jobs 
        </ul>
      </section>
    </div>

    <div class="slide hidden" id="slide-4">
      <section class="slide-content">
        <h3>Acquiring Genomic Data</h3>
        <pre><code class="perl">
@genomes = ("HG03673","HG03680","HG03681","HG03684",...);

while($i < @genomes) {
  system("mkdir ~/results/$genomes[$i]\n");
  my $qsub = "/home/wetherc/results/$genomes[$i]/qsub.$genomes[$i].sh";
  
  my $out;
  print $out "wget ftp://ftp.1000genomes.ebi.ac.uk/vol1/ftp/data/$genomes[$i]/sequence_read/*\n";
  close($out);

  system("chmod gu+x $qsub");
  system("qsub -m bae -M wetherc\@vbi.vt.edu $qsub");
  $i++;
}
          </code></pre>
      </section>
    </div>

    <div class="slide hidden" id="slide-5">
      <section class="slide-content">
        <h3>Parsing the Data: Mapping Against hg19</h3>
        <pre><code class="sh">
gunzip *.gz
cat *_1.filt.fastq > $_[0]_pairs_1.fastq
cat *_2.filt.fastq > $_[0]_pairs_2.fastq
rm *.filt.fastq

bwa mem -aY -t 5 -P -v 3 -U 25 /home/wetherc/reference/hg19.fa 
    /home/wetherc/results/$genomes[$i]/$genomes[$i]_pairs_1.fastq 
    /home/wetherc/results/$genomes[$i]/$genomes[$i]_pairs_2.fastq  > $_[0].sam
          </code></pre>
      </section>
    </div>

    <div class="slide hidden" id="slide-6">
      <section class="slide-content">
        <h3>Parsing the Data: Cleaning our Genomes</h3>
        <pre><code class="sh">
# Extract/print all alignments or subalignments in SAM format
# Sort alignments by leftmost coordinates
samtools view -hS $genomes[$i].sam -b | samtools sort - $genomes[$i]

# Remove PCR duplicates with samtools tools if it's not PCR free
samtools rmdup $genomes[$i].bam $genomes[$i].rdup.bam

# Index sorted alignment for fast random access
samtools index $genomes[$i].rdup.bam
        </code></pre>
      </section>
    </div>

    <div class="slide hidden" id="slide-7">
      <section class="slide-content">
        <h3>Parsing the Data: Discarding Mapped Reads</h3>
        <pre><code class="sh">
java -Xmx5g -jar /apps/packages/bio/picard/1.92/bin/AddOrReplaceReadGroups.jar 
    I=$genomes[$i].rdup.bam O=$genomes[$i].rdup.GATK.bam SORT_ORDER=coordinate 
    RGID=$genomes[$i] RGLB=bwa-mem RGPL=illumina RGSM=$genomes[$i]
    CREATE_INDEX=true RGPU=RGPU VALIDATION_STRINGENCY=SILENT

samtools view -u -f 4 $genomes[$i].rdup.GATK.bam > $genomes[$i].unmapped.sam
        </code></pre>
      </section>
    </div>

    <div class="slide hidden" id="slide-8">
      <section class="slide-content">
        <ul>
          <li>Cat sam files (samtools merge -nr)</li>
          <li>De Novo alignment</li>
          <li>Map against known contaminants</li>
          <li>Profit?</li>
        </ul>
      </section>
    </div>

    <div class="controls">
      <div class="arrow prev"></div>
      <div class="arrow next"></div>
    </div>
  </body>
</html>